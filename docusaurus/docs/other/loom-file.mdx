# Loom File

DataLoom saves data in JSON format in a file with a `.loom` extension.

When updating DataLoom, DataLoom will attempt to update your loom file to the latest file version. If you haven't updated DataLoom in a while, you may get a message indicating that your loom file is corrupt. This may occur when an Obsidian save fails or the file is accidentally edited.

To fix a corrupt loom file, please follow the instructions below.

## Fixing a corrupt file

1. Open the file in a text editor
2. Review each line of the file, making sure that it matches the current JSON format
3. For each line that doesn't match, make the necessary corrections. Often the problem is that a key is missing or misspelled

Note: If you are not sure what to do, please open an [issue](https://github.com/trey-wallis/obsidian-dataloom/issues/new?assignees=&labels=bug&projects=&template=BUG.yml) in GitHub repository or post in the `bugs` channel of the [Discord](https://discord.gg/QaFbepMdN4) community

## JSON format

### Meaning of symbols

Typescript words are used to describe the JSON format.

-   `string` - a string of characters - `"hello world"`. Always include double quotations.
-   `number` - a number - `123`
-   `boolean` - `true` or `false`
-   `null` - a null value - `null`
-   `[]` - a list of values - `[1, 2, 3]`

A word with a capital letter such as `CellType` or `Column` represents a reference to a JSON object or enum. These may bew viewed in the [references](#references) section.

## Example file

```javascript
{
  "model": {
    "columns": [
      {
        "id": "637bedf7-22df-4d9e-be39-722e28ad9147",
        "sortDir": "default",
        "isVisible": true,
        "width": "140px",
        "type": "text",
        "numberPrefix": "",
        "numberSuffix": "",
        "numberSeparator": "",
        "content": "New Column",
        "numberFormat": "number",
        "currencyType": "USD",
        "dateFormat": "mm/dd/yyyy",
        "shouldWrapOverflow": true,
        "tags": [],
        "calculationType": "none",
        "aspectRatio": "unset",
        "horizontalPadding": "unset",
        "verticalPadding": "unset"
      },
      {
        "id": "8456b494-fb1c-42b6-a55d-a0d4db5a6c98",
        "sortDir": "default",
        "isVisible": true,
        "width": "140px",
        "type": "tag",
        "numberPrefix": "",
        "numberSuffix": "",
        "numberSeparator": "",
        "content": "New Column",
        "numberFormat": "number",
        "currencyType": "USD",
        "dateFormat": "mm/dd/yyyy",
        "shouldWrapOverflow": true,
        "tags": [
          {
            "id": "be98ee4e-0f55-4d07-873d-7573b65fb695",
            "markdown": "tag1",
            "color": "gray"
          }
        ],
        "calculationType": "none",
        "aspectRatio": "unset",
        "horizontalPadding": "unset",
        "verticalPadding": "unset"
      }
    ],
    "rows": [
      {
        "id": "f4c063b9-a456-4d1c-81ef-0e1dd950103e",
        "index": 0,
        "creationTime": 1695580079305,
        "lastEditedTime": 1695580097547,
        "cells": [
          {
            "id": "91d434b5-76f6-44ea-b1f0-a670f1a66549",
            "isExternalLink": false,
            "columnId": "637bedf7-22df-4d9e-be39-722e28ad9147",
            "dateTime": null,
            "content": "test",
            "tagIds": []
          },
          {
            "id": "4fd2a1e9-b02e-4034-b162-d47681ba0a44",
            "isExternalLink": false,
            "columnId": "8456b494-fb1c-42b6-a55d-a0d4db5a6c98",
            "dateTime": null,
            "content": "",
            "tagIds": [
              "be98ee4e-0f55-4d07-873d-7573b65fb695"
            ]
          }
        ]
      }
    ],
    "filters": [
      {
        "id": "118adfb5-2c6b-46be-b370-782fd06d730e",
        "columnId": "637bedf7-22df-4d9e-be39-722e28ad9147",
        "operator": "or",
        "isEnabled": true,
        "type": "text",
        "condition": "is",
        "text": "test"
      }
    ],
    "settings": {
      "numFrozenColumns": 1,
      "showCalculationRow": true
    }
  },
  "pluginVersion": "8.6.0"
}
```

## Format

```javascript
{
  "model": {
    "columns": [
      {
        "id": string,
        "sortDir": SortDir,
        "isVisible": boolean,
        "width": string,
        "type": CellType,
        "numberPrefix": string,
        "numberSuffix": string,
        "numberSeparator": string,
        "content": string",
        "numberFormat": NumberFormat,
        "currencyType": CurrencyType,
        "dateFormat": DateFormat,
        "shouldWrapOverflow": boolean,
        "tags": Tag[],
        "calculationType": CalculationType,
        "aspectRatio": AspectRatio,
        "horizontalPadding": PaddingSize,
        "verticalPadding": PaddingSize
      },
      {
        "id": string,
        "sortDir": SortDir,
        "isVisible": boolean,
        "width": string,
        "type": CellType,
        "numberPrefix": string,
        "numberSuffix": string,
        "numberSeparator": string,
        "content": string,
        "numberFormat": NumberFormat,
        "currencyType": CurrencyType,
        "dateFormat": DateFormat,
        "shouldWrapOverflow": boolean,
        "tags": [
          {
            "id": string,
            "content": string,
            "color": Color
          }
        ],
        "calculationType": CalculationType,
        "aspectRatio": AspectRatio,
        "horizontalPadding": PaddingSize,
        "verticalPadding": PaddingSize
      }
    ],
    "rows": [
      {
        "id": string,
        "index": number,
        "creationTime": number,
        "lastEditedTime": number,
        "cells": [
          {
            "id": string,
            "isExternalLink": boolean,
            "columnId": string,
            "dateTime": number | null,
            "content": string,
            "tagIds": string[]
          },
          {
            "id": string,
            "isExternalLink": boolean,
            "columnId": string,
            "dateTime": number | null,
            "content": string,
            "tagIds": string[]
          }
        ]
      }
    ],
    "filters": [
      {
        "id": string,
        "columnId": string,
        "operator": FilterOperator,
        "isEnabled": boolean,
        "type": CellType,
        "condition": TextFilterCondition,
        "text": string
      }
    ],
    "settings": {
      "numFrozenColumns": number,
      "showCalculationRow": boolean
    }
  },
  "pluginVersion": string
}
```

### References

Here a list of some of the most common references

```javascript
interface Tag {
	id: string;
	content: string;
	color: Color;
}
```

```javascript
enum CellType {
	TEXT = "text",
	EMBED = "embed",
	FILE = "file",
	NUMBER = "number",
	TAG = "tag",
	MULTI_TAG = "multi-tag",
	DATE = "date",
	CHECKBOX = "checkbox",
	CREATION_TIME = "creation-time",
	LAST_EDITED_TIME = "last-edited-time",
}
```

```javascript
enum NumberFormat {
	NUMBER = "number",
	CURRENCY = "currency",
}
```

```javascript
enum Color {
	LIGHT_GRAY = "light gray",
	GRAY = "gray",
	BROWN = "brown",
	ORANGE = "orange",
	YELLOW = "yellow",
	GREEN = "green",
	BLUE = "blue",
	PURPLE = "purple",
	PINK = "pink",
	RED = "red",
}
```

```javascript
enum CurrencyType {
	ARGENTINA = "ARS",
	AUSTRALIA = "AUD",
	CANADA = "CAD",
	COLOMBIA = "COP",
	DENMARK = "DKK",
	UAE = "AED",
	EUROPE = "EUR",
	ICELAND = "ISK",
	ISRAEL = "ILS",
	MEXICO = "MXN",
	NORWAY = "NOK",
	GREAT_BRITAIN = "GBP",
	BRAZIL = "BRL",
	SAUDI_ARABIA = "SAR",
	RUSSIA = "RUB",
	INDIA = "INR",
	SINGAPORE = "SGB",
	SWEDEN = "SEK",
	SWITZERLAND = "CHF",
	UNITED_STATES = "USD",
	SOUTH_KOREA = "KRW",
	JAPAN = "JPY",
	CHINA = "CNY",
}
```

## Typescript declarations

The examples above are not comprehensive.

If you would like to see full typescript declarations for the file, please see the [GitHub repo](https://github.com/trey-wallis/obsidian-dataloom/blob/master/src/shared/loom-state/types/loom-state.ts)
